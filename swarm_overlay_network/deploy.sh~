#!/bin/bash

## key store container on a dedicated node
$ docker run -d -p 8500:8500 --name=consul progrium/consul -server -bootstrap

## docker engine to listen on 2375 on each node,(for swarm) give key store location(to use overlay network)
docker daemon -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock --cluster-store=consul://10.0.15.11:8500 --cluster-advertise=enp0s8:2375 &> /dev/null &


## swarm master node
$ docker run -d -p 4000:4000 swarm manage -H :4000 --advertise 10.0.15.11:4000 consul://10.0.15.11:8500

## start swarm slave nodes
$docker run -d swarm join --advertise=10.0.15.12:2375 consul://10.0.15.11:8500

## create overlay network on swarm master
docker -H :4000 network create -d overlay stack001


## now ready to launch applicatoin containers on swarm nodes!

docker -H :4000 run -itd --name shell-01 --net stack001 alpine /bin/sh
docker -H :4000 run -itd --name shell-02 --net stack001 alpine /bin/sh
